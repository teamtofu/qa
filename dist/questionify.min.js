/*!
 * Copyright (c) 2017 Russell Steadman
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
 * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE
 * OR OTHER DEALINGS IN THE SOFTWARE.
 */
!function(){"use strict";var e=["questionify","qu"],t={o:"object",s:"string",f:"function",b:"boolean",n:"number",r:"regex"},n={},r=function(){var e={angular:typeof angular===t.o&&!!angular,console:!!(typeof console===t.o&&console&&console.log&&console.error&&console.info),alert:typeof alert===t.f&&!!alert,document:typeof document===t.o&&!!document,body:typeof document===t.o&&!!document&&typeof document.body===t.o&&!!document.body,mutation:typeof MutationObserver===t.f&&!!MutationObserver,interval:typeof setInterval===t.f&&typeof clearInterval===t.f&&!!setInterval&&!!clearInterval,window:typeof window===t.o&&!!window,module:"undefined"!=typeof module&&module.exports};for(var r in e){n[r]=e[r]}return n},o=function(e,t,n,r){return"http://teamtofu.github.io/questionify/errors/?error="+e+"&one="+encodeURIComponent(t)+"&two="+encodeURIComponent(n)+"&three="+encodeURIComponent(r)},s=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},i=function(e){for(var t,n,r=e.length;r;t=parseInt(Math.random()*r),n=e[--r],e[r]=e[t],e[t]=n){}return e},a=function(e,t){var n=e.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");return t&&(n=n.replace(/\[([^\[]+)\]\(([^\)]+)\)/,'<a href="$2">$1</a>'),n=n.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),n=n.replace(/\_\_(.*?)\_\_/g,"<em>$1</em>"),n=n.replace(/\~\~(.*?)\~\~/g,"<del>$1</del>"),n=n.replace(/\:\"(.*?)\"\:/g,"<q>$1</q>"),n=n.replace(/\!\((.*?)\)\[(.*?)\]\!/g,'<div class="qu-markdown-image-bin"><img class="qu-markdown-image $2" src="$1" /></div>')),n},u=function(){this.version="1.0.0";var e={debugMode:!1,removeQuizAnswers:!1,shuffleQuizAnswers:!1,shuffleQuizQuestions:!1,enableMarkDown:!0},n={debugMode:t.b,removeQuizAnswers:t.b,shuffleQuizAnswers:t.b,shuffleQuizQuestions:t.b,enableMarkDown:t.b},u=function(){if(-1===n[zb].split("&").indexOf(typeof e[zb])){throw new Error(o("ah",zb,typeof e[zb],n[zb]))}};this.setOption=function(t,n){e[t]=n,u()},this.setOptions=function(n){if(typeof n===t.o){for(var r in n){e[r]=n[r]}}u()};var d=function(t){return a(t,e.enableMarkDown)};this.events=[];var c=function(n){r().console?console.error("(Questionify) "+n):typeof alert===t.f&&e.developerMode&&alert(n),this.events.push(n)}.bind(this),l=function(t){r().console&&e.debugMode&&console.info("(Questionify) "+t),this.events.push(t)}.bind(this);this.questions={};var f=function(e,n,r,o){if(typeof e!==t.s){return c("Question is not a string")}if(typeof n!==t.o){return c("Answers are not an array")}if(typeof r!==t.o){return c("Correct answer is not a array")}typeof o!==t.s&&(o="default");var i={group:o,id:s(),question:{text:e},answers:[],correct:[]};for(var a in n){var u={text:n[a],id:s(),correct:-1!==r.indexOf(Number(a))};u.correct&&i.correct.push(u.id),i.answers.push(u)}return this.questions[o]||(this.addSet(o),l("The group "+o+" didn't exist, so it was autocreated.")),this.questions[encodeURIComponent(o)].questions.push(i),i.id}.bind(this);this.addQuestion=function(e,t,n,r){return f(e,t,n,r)},this.addQuestions=function(e){var t=[];for(var n in e){var r=e[n].question,o=e[n].answers,s=e[n].correct,i=e[n].group;t.push(f(r,o,s,i))}return t},this.addSet=function(e){var n=[];typeof e!==t.o&&(e=[e]);for(var r in e){var o=s();this.questions[encodeURIComponent(e[r])]={id:o,questions:[]},n.push(o)}return n[1]?n:n[0]},this.addSet("default");var m=function(e,t){if(typeof e===t.s){try{e=JSON.parse(e)}catch(e){c(e)}}if(typeof e===t.o&&e.type===t){return Number(e.schema.split("qu-")[1])>1&&l("Update Questionify to support this schema version."),e}return null},p=function(e,t){return JSON.stringify({content:e,version:"1.0.0",type:t,schema:"qu-1.0",assetid:s()},null,4)};this.exportQuestions=function(){return p(this.questions,"export")},this.importQuestions=function(e){var t=m(e);return!!t&&(this.questions=t,!0)};var h=function(e,t,n,r){var o={questions:e,meta:{quizLength:t,quizName:n}};return r&&(o.meta.linkedTo=r),o};this.createQuiz=function(t,n,r){if(!this.questions[t]){return c("Group not found.")}r||(r=this.questions[t].questions.length);var o=JSON.stringify(this.questions[t].questions);if(o=JSON.parse(o),!e.removeQuizAnswers){var i={quiz:p(h(o,r,n),"quizCombo")};return this.loadQuiz(i.quiz),i}var a=[];for(var u in o){a.push({id:o[u].id,correct:o[u].correct}),delete o[u].correct;for(var d in o[u].answers){delete o[u].answers[d].correct}}var l=s(),f=p(h(o,r,n,l),"quizBlind"),m={key:a,meta:{linkedTo:l}};return m.meta.forAsset=JSON.parse(f).assetid,m=p(m,"answerKey"),this.loadQuiz(f),this.loadKey(m),{quiz:f,key:m}};var q={};this.loadQuiz=function(e){try{q.quiz=JSON.parse(e)}catch(e){return c(e)}},this.loadKey=function(e){try{q.key=JSON.parse(e)}catch(e){return c(e)}};var v={};this.getQuizTemplate=function(t){if(!q.quiz){return c("No quiz loaded.")}if(!r().document){return c("This action must be done it the client window.")}var n=q.quiz.assetid;v[n]=t;var o=(q.quiz.type,q.quiz.content),s=o.questions;if(q.key&&q.key.content.meta.linkedTo===o.meta.linkedTo){}var a=document.createElement("div");a.dataset.role="quiz",a.dataset.type=q.quiz.type,a.id=n,a.classList.add("questionify","qu-quiz",n);for(var u in s){e.shuffleQuizAnswers&&(s[u].answers=i(s[u].answers));var l=document.createElement("div");l.dataset.role="question",l.id=s[u].id,l.classList.add("qu-question",n,s[u].id),a.appendChild(l);var f=document.createElement("div");f.dataset.role="text",f.classList.add("qu-text",n,s[u].id),f.innerHTML="<strong>"+d(s[u].question.text)+"</strong>",l.appendChild(f);var m=document.createElement("ul");m.dataset.role="answer-group",m.classList.add("qu-answer-group",n,s[u].id),l.appendChild(m);for(var p in s[u].answers){var h=document.createElement("li");h.dataset.role="answer",h.id=s[u].answers[p].id,h.classList.add("qu-answer","qu-unselected-answer",n,s[u].id),h.setAttribute("onclick","questionify.dom.mark(this);"),h.innerHTML=d(s[u].answers[p].text),m.appendChild(h)}s.length-1!==Number(u)&&a.appendChild(document.createElement("hr"))}a.appendChild(document.createElement("br"));var y=document.createElement("div");y.dataset.role="submit",y.classList.add("qu-submit",n),y.setAttribute("onclick","questionify.dom.validate(this);"),y.innerHTML="Submit",a.appendChild(y);var w=document.createElement("div");return w.appendChild(a),w.innerHTML},this.style={},this.style.roboto=function(e){var t=document.getElementById("qu-font");t&&document.head.removeChild(t);var n=document.createElement("style");n.type="text/css",n.id="qu-font",n.innerHTML="@import url('https://fonts.googleapis.com/css?family="+(e?"Open+Sans":"Roboto")+"');",document.head.appendChild(n)},this.style.opensans=function(){this.roboto(!0)},this.style.set=function(){if(document.getElementById("qu-style")){return!1}var e=document.createElement("style");return e.type="text/css",e.id="qu-style",e.innerHTML="        .questionify {            font-family: 'Roboto', 'Open Sans', Arial, Helvetica, sans-serif;            font-size: 1rem;            -webkit-tap-highlight-color: rgba(255, 255, 255, 0);        }        .qu-quiz {            width: inherit;            color: #000000;        }        .qu-question {            width: 100%;            cursor: default;        }        .qu-answer-group {            cursor: pointer;            list-style-type: upper-alpha;            margin-left: 5%;            outline: none;        }        .qu-answer {            transition: color 0.5s ease, text-decoration 0.5s ease;        }        .qu-unselected-answer {            color: #999999;        }        .qu-unselected-answer:hover, .qu-unselected-answer:focus {            color: #000000;        }        .qu-selected-answer {            color: #962171;            text-decoration: underline;        }        .qu-explanation-hide {            display: none;        }        .qu-submit {            background-color: #962171;            border: none;            color: #ffffff;            padding: .5rem 1rem;            text-align: center;            cursor: pointer;            border-radius: .5vh;        }        .qu-submit.qu-submitted {            background-color: #2acc93;        }        .qu-error {            color: #ce3737;            font-style: italic;        }        .qu-markdown-image {            max-height: 10rem;            max-width: 10rem;            display: inline-block;        }        .qu-markdown-image-bin {            display: inline-block;            width: 10rem;        }        ",document.head.appendChild(e),!0},r().document&&this.style.set(),this.style.unset=function(){var e=document.getElementById("qu-style");return e&&document.head.removeChild(e),!0},this.dom={},this.dom.mark=function(e){if(e&&e.setAttribute){e.dataset.press=(new Date).getTime().toString();var n=e.parentNode.parentNode;n.dataset.answer=e.id;document.getElementsByClassName("qu-text "+n.id)[0].classList.remove("qu-error");var r=e.parentNode.childNodes;for(var o in r){typeof r[o]===t.o&&(r[o].classList.remove("qu-selected-answer"),r[o].classList.add("qu-unselected-answer"))}e.classList.remove("qu-unselected-answer"),e.classList.add("qu-selected-answer")}},this.dom.validate=function(e){var n=e.parentNode.childNodes;for(var r in n){if(typeof n[r]===t.o&&"question"===n[r].dataset.role){var o=document.getElementsByClassName("qu-text "+n[r].id)[0];if(o.classList.remove("qu-error"),!n[r].dataset.answer){var s=!0;o.classList.add("qu-error")}}}s||this.callback(e.parentNode.id)},this.dom.callback=function(e){var n=document.getElementById(e).childNodes,r={response:{},assetid:e};for(var o in n){typeof n[o]===t.o&&"question"===n[o].dataset.role&&(r.response[n[o].id]=n[o].dataset.answer||"")}var s=v[e];if(s){typeof s===t.f?s(r):typeof s===t.o&&typeof s.resolve===t.f&&s.resolve(r);var i=document.getElementsByClassName("qu-submit "+e)[0];i&&(i.innerHTML="Submitted",i.classList.add("qu-submitted"),i.removeAttribute("onclick"))}else{c("No callback was specified for quiz "+e+".")}},this.gradeQuiz=function(e){var t=e.assetid,n=e.response,r=null;if(q.key&&q.key.meta.forAsset===t){r=q.key.content.key}else{if(!q.quiz||"quizCombo"!==q.quiz.type||t!==q.quiz.assetid){return c("No key or quiz with answers loaded.")}r=q.quiz.content.questions}var o={},s=0;for(var i in n){o[i]=!1;for(var a in r){i===r[a].id&&-1!==r[a].correct.indexOf(n[i])&&(o[i]=!0,s++)}}var u=Object.keys(o).length;return{answers:o,numberCorrect:s,numberAnswered:u,percentCorrect:s/(u>=1?u:1)}},this.getGroupByName=function(e){return this.questions[e]?this.questions[e].questions:null},this.getGroupById=function(e){for(var t in this.questions){if(this.questions[t].id===e){return this.questions[t].questions}}return null},this.getQuestionById=function(e){for(var t in this.questions){for(var n in this.questions[t].questions){if(this.questions[t].questions[n].id===e){return this.questions[t].questions[n]}}}return null}},d=new u;if(r().module&&(module.exports=d),r().window){for(var c in e){window[e[c]]=d}}}();